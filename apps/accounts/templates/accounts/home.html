{% extends 'base.html' %}
{% load static %}
{% load study_extras %}

{% block title %}TOEIC ë‹¨ì–´ í•™ìŠµ{% endblock %}

{% block extra_css %}
<style>
    /* ë„¤ë¹„ê²Œì´ì…˜ ë°” ìŠ¤íƒ€ì¼ */
    .navbar {
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .navbar-nav .nav-link {
        position: relative;
        padding: 0.5rem 1rem;
        transition: all 0.3s ease;
    }
    
    .navbar-nav .nav-link:hover {
        color: #fff !important;
        background-color: rgba(255,255,255,0.1);
        border-radius: 4px;
    }
    
    .navbar-nav .nav-link.active {
        color: #fff !important;
        background-color: rgba(255,255,255,0.2);
        border-radius: 4px;
        font-weight: 500;
    }
    
    .navbar-nav .nav-link.active::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 20px;
        height: 3px;
        background-color: #fff;
        border-radius: 2px;
    }
    
    .navbar-nav .nav-link:hover::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 20px;
        height: 3px;
        background-color: #fff;
        border-radius: 2px;
        opacity: 0.7;
    }
</style>
{% endblock %}

{% block extra_head %}
<script>
// ìŒì„± í•©ì„± ì´ˆê¸°í™”
const synth = window.speechSynthesis;

// í…ìŠ¤íŠ¸ë¥¼ ìŒì„±ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì¬ìƒí•˜ëŠ” í•¨ìˆ˜
function speakText(text) {
    if (!synth) {
        console.error('ìŒì„± í•©ì„±ì´ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
        return;
    }
    
    // ì´ì „ ìŒì„±ì´ ì¬ìƒ ì¤‘ì´ë©´ ì¤‘ì§€
    synth.cancel();
    
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    utterance.rate = 0.8;
    
    // ìŒì„± ì¬ìƒ ì‹œì‘/ì¢…ë£Œ ì‹œ ë¡œê¹…
    utterance.onstart = () => console.log('ìŒì„± ì¬ìƒ ì‹œì‘:', text);
    utterance.onend = () => console.log('ìŒì„± ì¬ìƒ ì¢…ë£Œ');
    utterance.onerror = (e) => console.error('ìŒì„± ì¬ìƒ ì˜¤ë¥˜:', e);
    
    synth.speak(utterance);
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ìŒì„± í•©ì„± ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', function() {
    console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
    
    // ë‹¨ì–´ ë°œìŒ ë²„íŠ¼
    const wordSpeakButtons = document.querySelectorAll('.btn-speak-word');
    console.log('ë°œìŒ ë²„íŠ¼ ì°¾ìŒ:', wordSpeakButtons.length);
    wordSpeakButtons.forEach(button => {
        button.addEventListener('click', function() {
            const text = this.getAttribute('data-text');
            console.log('ë²„íŠ¼ í´ë¦­:', text);
            speakText(text);
        });
    });

    // ì˜ˆë¬¸ ë°œìŒ ë²„íŠ¼
    const exampleSpeakButtons = document.querySelectorAll('.btn-speak-example');
    console.log('ì˜ˆë¬¸ ë°œìŒ ë²„íŠ¼ ì°¾ìŒ:', exampleSpeakButtons.length);
    exampleSpeakButtons.forEach(button => {
        button.addEventListener('click', function() {
            const text = this.getAttribute('data-text');
            console.log('ì˜ˆë¬¸ ë²„íŠ¼ í´ë¦­:', text);
            speakText(text);
        });
    });
});
</script>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-md-12 text-center">
            <h1 class="display-4">TOEIC ë‹¨ì–´ í•™ìŠµ</h1>
            <p class="lead">íš¨ìœ¨ì ì¸ TOEIC ë‹¨ì–´ í•™ìŠµì„ ì‹œì‘í•˜ì„¸ìš”!</p>
        </div>
    </div>

    {% if user.is_authenticated %}
    <!-- ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë¥¼ ìœ„í•œ ëŒ€ì‹œë³´ë“œ -->
    <div class="row">
        <!-- ì˜¤ëŠ˜ì˜ í•™ìŠµ í˜„í™© -->
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">ì˜¤ëŠ˜ì˜ í•™ìŠµ í˜„í™©</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <p>ëª©í‘œ: {{ daily_goal }}ê°œ</p>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" 
                                 style="width: {{ today_progress|div:daily_goal|mul:100 }}%">
                            </div>
                        </div>
                    </div>
                    <p class="card-text">ì˜¤ëŠ˜ í•™ìŠµí•œ ë‹¨ì–´: {{ today_progress }}/{{ daily_goal }}ê°œ</p>
                    {% if today_progress|add:'0' >= daily_goal|add:'0' %}
                    <div class="alert alert-success text-center mt-3" role="alert" style="font-size:1.1rem;">
                        ğŸ‰ ì˜¤ëŠ˜ì˜ ëª©í‘œë¥¼ ë‹¬ì„±í•˜ì…¨ìŠµë‹ˆë‹¤! ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- ì˜¤ëŠ˜ì˜ ë‹¨ì–´ -->
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">ì˜¤ëŠ˜ì˜ ë‹¨ì–´</h5>
                </div>
                <div class="card-body">
                    {% if todays_word %}
                    <div class="word-card">
                        <h4>{{ todays_word.english }}</h4>
                        <p class="pronunciation">[{{ todays_word.part_of_speech }}]</p>
                        <p>{{ todays_word.korean }}</p>
                        <div class="d-flex justify-content-center gap-2 mb-2">
                            <button class="btn btn-sm btn-primary btn-speak-word" data-text="{{ todays_word.english|escapejs }}">
                                <i class="fas fa-volume-up"></i> ë‹¨ì–´ ë°œìŒ
                            </button>
                            {% if todays_word.example_sentence %}
                            <button class="btn btn-sm btn-secondary btn-speak-example" data-text="{{ todays_word.example_sentence|escapejs }}">
                                <i class="fas fa-volume-up"></i> ì˜ˆë¬¸ ë°œìŒ
                            </button>
                            {% endif %}
                        </div>
                        {% if todays_word.example_sentence %}
                        <p class="small text-muted">{{ todays_word.example_sentence }}</p>
                        <p class="text-muted"><small>{{ todays_word.example_translation }}</small></p>
                        {% endif %}
                    </div>
                    {% else %}
                    <p class="text-muted text-center">ì¶”ì²œ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- í•™ìŠµ í†µê³„ -->
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="card-title mb-0">ë‚˜ì˜ í•™ìŠµ í†µê³„</h5>
                </div>
                <div class="card-body">
                    <p>ì´ í•™ìŠµ ë‹¨ì–´: {{ total_studied_words }}ê°œ</p>
                    <p>í˜„ì¬ ë ˆë²¨: {{ user.profile.level }}</p>
                    <p>ê²½í—˜ì¹˜: {{ user.profile.experience }}/100</p>
                    <a href="{% url 'study:statistics' %}" class="btn btn-primary">ìì„¸íˆ ë³´ê¸°</a>
                </div>
            </div>
        </div>
    </div>

    <!-- í€µ ë©”ë‰´ -->
    <div class="row">
        <div class="col-md-3 mb-4">
            <a href="{% url 'vocabulary:word_list' %}" class="card text-decoration-none">
                <div class="card-body text-center">
                    <h5 class="card-title">ë‹¨ì–´ì¥</h5>
                    <p class="card-text">TOEIC í•„ìˆ˜ ë‹¨ì–´ë¥¼ í•™ìŠµí•˜ì„¸ìš”</p>
                </div>
            </a>
        </div>
        <div class="col-md-3 mb-4">
            <a href="{% url 'quiz:quiz_home' %}" class="card text-decoration-none">
                <div class="card-body text-center">
                    <h5 class="card-title">í€´ì¦ˆ</h5>
                    <p class="card-text">ë‹¤ì–‘í•œ í€´ì¦ˆë¡œ ì‹¤ë ¥ì„ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”</p>
                </div>
            </a>
        </div>
        <div class="col-md-3 mb-4">
            <a href="{% url 'study:wrong_notes' %}" class="card text-decoration-none">
                <div class="card-body text-center">
                    <h5 class="card-title">ì˜¤ë‹µ ë…¸íŠ¸</h5>
                    <p class="card-text">í‹€ë¦° ë‹¨ì–´ë¥¼ ë³µìŠµí•˜ì„¸ìš”</p>
                </div>
            </a>
        </div>
        <div class="col-md-3 mb-4">
            <a href="{% url 'vocabulary:bookmarked_words' %}" class="card text-decoration-none">
                <div class="card-body text-center">
                    <h5 class="card-title">ë¶ë§ˆí¬</h5>
                    <p class="card-text">ì¤‘ìš” ë‹¨ì–´ë¥¼ ëª¨ì•„ë³´ì„¸ìš”</p>
                </div>
            </a>
        </div>
    </div>
    {% else %}
    <!-- ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ìë¥¼ ìœ„í•œ ì†Œê°œ -->
    <div class="row">
        <div class="col-md-12 text-center mb-4">
            <h2>TOEIC ë‹¨ì–´ í•™ìŠµì˜ íŠ¹ì§•</h2>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body text-center">
                    <i class="fas fa-book fa-3x mb-3 text-primary"></i>
                    <h5 class="card-title">ì²´ê³„ì ì¸ í•™ìŠµ</h5>
                    <p class="card-text">ì¼ì¼ í•™ìŠµ ëª©í‘œë¥¼ ì„¤ì •í•˜ê³  ì²´ê³„ì ìœ¼ë¡œ ë‹¨ì–´ë¥¼ í•™ìŠµí•˜ì„¸ìš”.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body text-center">
                    <i class="fas fa-sync fa-3x mb-3 text-success"></i>
                    <h5 class="card-title">ìŠ¤ë§ˆíŠ¸ ë³µìŠµ</h5>
                    <p class="card-text">í•™ìŠµí•œ ë‹¨ì–´ë¥¼ ìë™ìœ¼ë¡œ ë³µìŠµí•˜ì—¬ ì¥ê¸° ê¸°ì–µì„ ê°•í™”í•˜ì„¸ìš”.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card h-100">
                <div class="card-body text-center">
                    <i class="fas fa-chart-bar fa-3x mb-3 text-info"></i>
                    <h5 class="card-title">í•™ìŠµ í†µê³„</h5>
                    <p class="card-text">ìƒì„¸í•œ í•™ìŠµ í†µê³„ë¡œ ìì‹ ì˜ ì‹¤ë ¥ì„ í™•ì¸í•˜ê³  ë°œì „í•˜ì„¸ìš”.</p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
function speakText(text) {
    if (!window.speechSynthesis) {
        console.error('ìŒì„± í•©ì„±ì´ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
        return;
    }
    
    // ì´ì „ ìŒì„±ì´ ì¬ìƒ ì¤‘ì´ë©´ ì¤‘ì§€
    window.speechSynthesis.cancel();
    
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    utterance.rate = 0.8;
    
    // ìŒì„± ì¬ìƒ ì‹œì‘/ì¢…ë£Œ ì‹œ ë¡œê¹…
    utterance.onstart = () => console.log('ìŒì„± ì¬ìƒ ì‹œì‘:', text);
    utterance.onend = () => console.log('ìŒì„± ì¬ìƒ ì¢…ë£Œ');
    utterance.onerror = (e) => console.error('ìŒì„± ì¬ìƒ ì˜¤ë¥˜:', e);
    
    window.speechSynthesis.speak(utterance);
}
</script>
{% endblock %} 